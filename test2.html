
<!DOCTYPE html>
<html>
  <head>
    <title>ClearPath Maps</title>
	<link rel="shortcut icon" href="images2/favicon.ico" >
    <link rel="icon" type="image/gif" href="images2/animated_favicon1.gif" >
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />	
    <link rel="stylesheet" href="jquery/development-bundle/themes/base/jquery.ui.all.css">
	<!-- <script type="text/javascript" src="jquery.js"></script> -->
	<script src="jquery/js/jquery-1.7.1.min.js"></script>
	<script src="jquery/development-bundle/ui/jquery.ui.core.js"></script>
	<script src="jquery/development-bundle/ui/jquery.ui.widget.js"></script>
	<script src="jquery/development-bundle/ui/jquery.ui.mouse.js"></script>
	<script src="jquery/development-bundle/ui/jquery.ui.slider.js"></script>
	<link rel="stylesheet" href="jquery/development-bundle/demos/demos.css">
    <link href="../static/stylesheets/bootstrap-toggle-buttons.css"
          rel="stylesheet">
	<style>
	#demo-frame > div.demo { padding: 10px !important; };
	</style>
	
	<style type="text/css">
	.getpath {
		-moz-box-shadow:inset 0px 1px 0px 0px #97c4fe;
		-webkit-box-shadow:inset 0px 1px 0px 0px #97c4fe;
		box-shadow:inset 0px 1px 0px 0px #97c4fe;
		background-color:#4c8799;
		border:2px solid #c4d8f5;
		display:inline-block;
		color:#d6fbff;
		font-family:arial;
		font-size:15px;
		font-weight:bold;
		padding:6px 21px;
		text-decoration:none;
		text-shadow:1px 1px 0px #0000ed;
	}.getpath:hover {
		background-color:#257a94;
	}.getpath:active {
		position:relative;
		top:1px;
	}
	#btn{
		padding:6px 125px;	
	}
	/* This imageless css button was generated by CSSButtonGenerator.com */
	</style>
	
    <style type="text/css">
	  .sl { width:340px; }
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map_canvas { height: 100% }
    </style>
	
    <style>
      body {
        font-family: sans-serif;
        font-size: 14px;
      }
	  select, option, label{
        font-size: 18px;
		font-family: arial, sans-serif;
	  }
      #map_canvas {
        height: 400px;
        width: 600px;
        margin-top: 0.6em;
      }
      input {
        border: 1px solid  rgba(76, 135, 153, 0.5);
		font-size: 18px;
      }
      input.notfound {
        border: 2px solid  rgba(255, 0, 0, 0.4);
      }
    </style>

	<script>
	$(function() {
		$( "#slider" ).slider({
			value:0,
			min: 360,
			max: 1200,
			step: 15,
			slide: function( event, ui ) {
			var hours = Math.floor(ui.value / 60);
			var hoursAMPM;
            var minutes = ui.value - (hours * 60);
			dataChangedOnSlide();

            if(hours<10) 
			hours = '0' + hours;
            if(minutes== 0) 
			minutes = '00';
			
			$( "#time_select" ).val( hours+':'+minutes );
			hoursAMPM = hours%12;
			if(hoursAMPM == 0)
				hoursAMPM = '12';
			else if(hoursAMPM>0 && hoursAMPM<10)
				hoursAMPM = '0' + hoursAMPM;
			if((Math.floor(hours/12)) == 0)
				$( "#time_selectAMPM" ).val( hoursAMPM+':'+minutes+' AM');			
			else
				$( "#time_selectAMPM" ).val( hoursAMPM+':'+minutes+' PM');			
			}
		});
		var current = new Date();
		var currentHours = current.getHours();
		var currentHoursAMPM;
		var currentMinutes = current.getMinutes();
		var optionValue;
		if(currentHours<6){
			currentHours = 6;
			optionValue = 360;	
			currentMinutes = 0;
		}
		else if(currentHours>20){
			currentHours = 20;
			optionValue = 1200;
			currentMinutes = 0;
		}
		else{
			optionValue = (currentHours)*60+(Math.ceil(currentMinutes/15))*15;	
			currentMinutes = (Math.ceil(currentMinutes/15))*15;
		}
		
		if(currentMinutes == 60){
			currentMinutes = 0;
			currentHours += 1;
		}
					
		if(currentHours<10) 
			currentHours = '0' + currentHours;
		if(currentMinutes == 0) 
			currentMinutes = '00';					
			
		//$( "#slider" ).slider( "option", "value", 480 );
		$( "#slider" ).slider( "option", "value", optionValue );
		$( "#time_select" ).val( currentHours+':'+currentMinutes);
		
		currentHoursAMPM = currentHours%12;
		if(currentHoursAMPM == 0)
			currentHoursAMPM = '12';
		else if(currentHoursAMPM>0 && currentHoursAMPM<10)
			currentHoursAMPM = '0'+currentHoursAMPM;
			
		if((Math.floor(currentHours/12)) == 0)
			$( "#time_selectAMPM" ).val( currentHoursAMPM+':'+currentMinutes+' AM');
		else
			$( "#time_selectAMPM" ).val( currentHoursAMPM+':'+currentMinutes+' PM');
	});
	</script>
	<script type="text/javascript"
		src="http://maps.googleapis.com/maps/api/js?key=AIzaSyBOiIXn23pwlpvSxWFN6kS64m5Oo8YsquU&sensor=true&libraries=places">
	</script>
    <script type="text/javascript">
    var directionsDisplay;
	var rendererOptions;
    var directionsService = new google.maps.DirectionsService();
	var los_angeles = new google.maps.LatLng(34,-118.3);
	var map;
	var markers = null;	
	var count=0;
	var req;
	var output;
	var lati= new Array();
	var longi= new Array();
	var turn;
	var nodesinfo;
	var poly = null;
	var toLatLng; var fromLocationLL; var toLocationLL;
	var clearpathTime; var clickedGetButton=0;
	var browserSupportFlag = new Boolean();
	
	var polyOptions = {
		    strokeColor: '#31B404',
		    strokeOpacity: 1.0,
		    strokeWeight: 4
		  }
		  
	function getturnInfo(){
       //alert("123");
	   //document.getElementById('map_canvas').style.display = "none";
	   //document.getElementById('btn2').style.display = "none";
	   //document.getElementById('newSearch').style.display = "none";	   
	   //document.getElementById('btn').style.visibility = "hidden";
	   //document.getElementById('slider').style.visibility="hidden";
	   
	   checkDepartNowRadio();
	   checkArriveByRadio();
	   
	   	if(document.getElementById('content').style.visibility == "visible"){
			//document.getElementById('content').style.visibility = "hidden";
		}
		else{
			document.getElementById('content').style.visibility = "visible";
		}
	 
	 
	 // var a = "c<br>";
	  //a = a+"b";
	  var nodes = turn.split(",");
	  var count_t = 0;
	  var out="";
	  var row = 0;
	  var totalDistance = 0;
	  var accidents = 0;
	  var directionData='<table style="width:352px;">';
	  //alert(nodes.length);
	  for(var i=0;i<nodes.length &&(accidents == null || accidents == 0);i+=5){
	        //if(count_t == 0)
			out += "<font size=3>"+ ++row +"</font>. ";
			
	        //count_t++;
			//out += "<font size=3>"+nodes[i]+" "+nodes[i+1]+" "+nodes[i+2]+" "+nodes[i+3]+" "+nodes[i+4]+"</font></br>";
			//if((count_t>=0&&count_t<=4))
			//out = out +"<font size=3>,</font> ";
			//if(count_t == 5){
			// out = out + "<br>";
			//  count_t = 0;
			//}
			var startWord;
			if(i==0)
				startWord = 'Head';
			else	
				startWord = 'Turn';
				
			var direction = nodes[i];
			directionData += '<tr>';
			if(direction == 'F' || direction == 'N'){
				directionData += '<td  align="center"><img src="images2/directions/straight.png" style="height:80% width:80%"></td><td align="left" style="padding-left:15;">';
				if(direction == 'F')
					directionData += ' Continue onto';
				else if(direction == 'N')
					directionData += ' Head north on ';
			}
			else if(direction == 'W' || direction == 'L'){
				directionData += '<td  align="center"><img src="images2/directions/left_turn.png"></td><td align="left">';     
				if(direction == 'L')
					directionData += ' Turn left onto ';
				else if(direction == 'W')
					directionData += ' Head west on ';				
			}
			else if(direction == 'E' || direction == 'R'){
				directionData += '<td  align="center"><img src="images2/directions/right_turn.png"></td><td align="left">';                			
				if(direction == 'R')
					directionData += ' Turn right onto ';
				else if(direction == 'E')
					directionData += ' Head east on ';								
			}
			else if(direction == 'SL')
				directionData += '<td  align="center"><img src="images2/directions/left_turn.png"></td><td align="left" style="padding-left:10;">'+startWord+' slight left ';                			
			else if(direction == 'SR')
				directionData += '<td  align="center"><img src="images2/directions/right_turn.png"></td><td align="left" style="padding-left:10;">'+startWord+' slight right ';                			
			else if(direction == 'M')
				directionData += '<td  align="center"><img src="./images2/directions/merge.png" style="width:60%;"></td><td align="left" style="padding-left:10;">'+'Merge ahead onto ';                			
			else if(direction == 'M-VLR')
				directionData += '<td  align="center"><img src="images2/directions/straight.png"></td><td align="left" style="padding-left:10;">'+'Merge ahead via left ramp onto ';                			
			else if(direction == 'EXIT')
				directionData += '<td  align="center"><img src="images2/directions/exit.png" style="width:50%;"></td><td align="left" style="padding-left:10;">'+'Take exit on ';                			
			else
				directionData += '<td  align="center"><img src="images2/directions/straight.png"></td><td align="left" style="padding-left:10;">'+'Continue onto ';      
			
			var miles = nodes[i+4].split(';')[0];
			accidents = nodes[i+4].split(';')[1];
			//accidents = accidents.match(/\d+/);
			accidents = /(\d+)/.exec(accidents);
			directionData += nodes[i+1]+'</td><td align="right">'+miles+'</td>';
			directionData += '</tr>';		
			totalDistance += parseFloat(miles);
			//alert('i'+i+' miles:'+miles+' '+'TD:'+totalDistance+' accidents:'+accidents);
			//if(i == 75)
				//alert(accidents+'i: '+i+'\nDirection Data:\n'+directionData);
		}
		directionData += '</table>';	
		//alert(totalDistance+' '+accidents[i]);
		document.getElementById('totalDistance').innerHTML =  '<font size=4>Distance: '+ Math.floor(totalDistance) +' miles</font>';	
		document.getElementById('accidents').innerHTML =  '<font size=4>Accidents: ' +accidents[1]+ '</font>';
		
		//alert(directionData);
	//document.getElementById('content').innerHTML=(nodesinfo+"<br>"+out);
	  document.getElementById('content').innerHTML=directionData;
	  document.getElementById('turninfo').style.display = "block";
	  document.getElementById('loadingImage').style.visibility="hidden";	  
	}	
	
	function onButtonClick(){
		//alert("hello");
		var fromLocation = document.getElementById('from').value;
		var toLocation = document.getElementById('to').value;		
		if(fromLocation!='' && toLocation!='' && fromLocation!='Enter a location' && toLocation!='Enter a location'){
			if(clickedGetButton==0){
				getLatLongFromAddress(getPath);
			}
		}
		else
		{
				getPath();
		}
	}
	
	function onRadioListener(){
		dataChanged();
		checkDepartNowRadio();				
		checkArriveByRadio();
	}
	
	/*++ swapnil.c: getting lat long from given locations and apply markers to map ++*/
	function getLatLongFromAddress(callback) 
	{
		var fromLocation = document.getElementById('from').value;
		var toLocation = document.getElementById('to').value;	
		//var browserSupportFlag = new Boolean();
		//alert(fromLocation);
		//alert(window.innerWidth+'x'+window.innerHeight);
		if(fromLocation!='Enter a location' && toLocation!='Enter a location' && fromLocation!='' && toLocation!=''){
			//alert('success');
			if(fromLocation != 'My Location'){
				var geocoder = new google.maps.Geocoder();
				geocoder.geocode( { 'address' : fromLocation }, function( results, status ) {
					if ( status == google.maps.GeocoderStatus.OK ) {
						var fromLL = document.getElementById('fromLatLng'); // fromLatLng is my hidden field, use your own
						//alert(results[0].geometry.location.lat());
						//var fLL = results[0].geometry.location.lat() + ',' + results[0].geometry.location.lng();
						fromLL.innerHTML = results[0].geometry.location.lat() + ',' + results[0].geometry.location.lng();
						
						//alert(fromLL.innerHTML);
						////alert(fLL);
						fromLocationLL = new google.maps.LatLng(results[0].geometry.location.lat(), results[0].geometry.location.lng());
						//callback();
						//alert(fromLocationLL);
					} else {
						alert( "Geocode was not successful for the following reason: " + status );
					}
				});
			}
			else{
				  // Try W3C Geolocation (Preferred)
				  if(navigator.geolocation) {
					browserSupportFlag = true;
					navigator.geolocation.getCurrentPosition(function(position) {
					  //initialLocation = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);
					  var fromLL = document.getElementById('fromLatLng'); // fromLatLng is my hidden field, use your own
					  fromLL.innerHTML = position.coords.latitude + ',' + position.coords.longitude;
					  fromLocationLL = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);
					  document.getElementById('from').value = 'My Location';
					}, function() {
					  handleNoGeolocation(browserSupportFlag);
					});
				  }		
				  // Browser doesn't support Geolocation
				  else {
					browserSupportFlag = false;
					handleNoGeolocation(browserSupportFlag);
				  }	
			}

	  
			//delay(1000);
			//setTimeout(alert("Hello "), 2000);
			//alert(fromLocationLL);
		
			var geocoder2 = new google.maps.Geocoder();
			geocoder2.geocode( { 'address' : toLocation }, function( results, status ) {
				if ( status == google.maps.GeocoderStatus.OK ) {
					var toLL = document.getElementById('toLatLng'); // fromLatLng is my hidden field, use your own
					toLL.innerHTML = results[0].geometry.location.lat() + ',' + results[0].geometry.location.lng();			
					//alert(toLL.innerHTML);
					toLocationLL = new google.maps.LatLng(results[0].geometry.location.lat(), results[0].geometry.location.lng());
					callback();
					//alert(toLocationLL);
				} else {
					//alert( "Geocode was not successful for the following reason: " + status );
				}
			}); 
			
			var mb = $('#fromLatLng').text();		
			var mb1 = $('#toLatLng').text();
			markers = new Array();
			if(mb!='fromLL' && mb1!='toLL'){
				//alert(fromLocationLL);
				markers[0] = new google.maps.Marker({
				position: fromLocationLL,
				map: map
				});
				markers[1] = new google.maps.Marker({
				position: toLocationLL,
				map: map
				});
				///document.getElementById('slider').disabled=false;
				checkDepartNowRadio();				
				checkArriveByRadio();
			}
		}
		else{
			getPath();
		}
	}
	/*-- swapnil.c: getting lat long from given locations and apply markers to map --*/  
	
	function getPath(){
		////alert("Get Path Called");
		
		clickedGetButton=1;
		
		directionsDisplay.setMap(null);
		// Create a renderer for directions and bind it to the map.	
		directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);
		directionsDisplay.setMap(map);
		//poly.getPath().clear();
		////alert("Get Path Called test");	
		
		var mb = $('#fromLatLng').text();		
		var mb1 = $('#toLatLng').text();

		
		poly = new google.maps.Polyline(polyOptions);
		poly.setMap(map);
		document.getElementById('tt').style.visibility="hidden";
		document.getElementById('tt2').style.visibility="hidden";
		lati= new Array();
		longi= new Array();
		var time = document.getElementById('time_select').value;
		var hrs = parseInt(time.substring(0,2),10);
		var mins = parseInt(time.substring(3,5),10);
		
		var index = ((hrs-6)*4)+(mins/15);
		////alert(time+" "+hrs+" "+mins+" "+index);		
		var day = document.getElementById('day').value;
		
		var fromLocation = document.getElementById('from').value;
		var toLocation = document.getElementById('to').value;	
		if(fromLocation!='' && toLocation!='' && fromLocation!='Enter a location' && toLocation!='Enter a location'){
			//alert('inside2');
			////alert(lat1+","+long1+":"+lat2+","+long2);
			//var url="http://localhost:8080/TDSP_Servlet/TDSPQueryListNewFibo1234?start="+lat1+","+long1+"&end="+lat2+","+long2+"&time="+index+"&update=False&day="+day;
			//var url="http://geodb.usc.edu:8080/TDSP_Servlet/TDSPQueryListNewFibo1234?start="+lat1+","+long1+"&end="+lat2+","+long2+"&time="+index+"&update=False&day="+day;
					//var url="http://128.125.163.86/TDSP_Servlet/TDSPQuerySuper6?start="+lat1+","+long1+"&end="+lat2+","+long2+"&time="+index+"&update=False2&day="+day;	
			if(mb!='fromLL' && mb1 != 'toLL'){		
					//alert(mb+":"+mb1+":"+index+":"+day);
				var departNow = document.getElementById('depart_now').checked; 
				if(departNow==true)	{
					var url="http://128.125.163.86/TDSP_Servlet/TDSPQuerySuper6?start="+mb+"&end="+mb1+"&time="+index+"&update=False1&day="+day;				
					getPathNodes(url);
				} else{
					var url="http://128.125.163.86/TDSP_Servlet/TDSPQuerySuper6?start="+mb+"&end="+mb1+"&time="+index+"&update=False2&day="+day;	
					getPathNodes(url);					
				}
			}
			else{
				//alert('fromLL error');
			}
		}		
		else{
			//alert('inside');
			var lat1= markers[0].getPosition().lat();
			//alert(lat1);
			var long1= markers[0].getPosition().lng();
			var lat2= markers[1].getPosition().lat();
			var long2= markers[1].getPosition().lng();	
				var departNow = document.getElementById('depart_now').checked; 
				if(departNow==true)	{
					var url="http://128.125.163.86/TDSP_Servlet/TDSPQuerySuper6?start="+lat1+","+long1+"&end="+lat2+","+long2+"&time="+index+"&update=False1&day="+day;	
					getPathNodes(url);
				} else{
					var url="http://128.125.163.86/TDSP_Servlet/TDSPQuerySuper6?start="+lat1+","+long1+"&end="+lat2+","+long2+"&time="+index+"&update=False2&day="+day;						
					getPathNodes(url);					
				}			
		}
	}
	
	function getPathNodes(url) { 
		////alert("Get Path Nodes Called");
		//document.getElementById('btn').style.visibility="hidden";
		//document.getElementById('slider').style.visibility="hidden";
		document.getElementById('loading').style.visibility="visible";
		document.getElementById('loadingImage').style.visibility="visible";
		checkDepartNowRadio();				
		checkArriveByRadio();
		
		req = new XMLHttpRequest();  
		req.open("GET",url,true);
		req.onreadystatechange = pushPath;
		req.setRequestHeader("Connection", "Close");
		req.setRequestHeader("Method", "GET" + url + "HTTP/1.1");
		req.send(null);
	} 

	function pushPath(){
		////alert("Push Path Called");
		//var output=document.getElementById('nodes');
				
		 if (req.readyState == 4) {		
		 try{
		    output = req.responseText;
			//output.innerHTML = req.responseText;				
			}
		 catch (exception){
			output.innerHTML = exception;
			}
		 processOutput();
		}
		 document.getElementById('btn').style.visibility="visible";
		 document.getElementById('loading').style.visibility="hidden";
		 document.getElementById('loadingImage').style.visibility="hidden";
		 ///document.getElementById('slider').style.visibility="visible";
		 checkDepartNowRadio();				
		 checkArriveByRadio();
	}
	
	function processOutput(){
		////alert("Process Output Called");
		var nodes = output.split("@")[0].split(";");
		nodesinfo = output.split("@")[0];
		turn = output.split("@")[1];
		////alert(nodes.length);
		//document.getElementById('tt2').innerHTML = "<font size=2>"+ nodes.length + "</font>";
		for(var i=0;i<nodes.length-1;i++){
			lati[i] = nodes[i].split(",")[0];
			longi[i] = nodes[i].split(",")[1];
		}
		tt = nodes[nodes.length-1].split("-")[0];
		drawPoints();
		////alert(Math.floor(parseFloat(tt)));
		clearpathTime = Math.floor(parseFloat(tt));
		if(tt != '}'){
			//document.getElementById('tt').innerHTML = ("<font size=4>ClearPath: "+Math.floor(parseFloat(tt))+" minutes</font>");
			document.getElementById('tt').innerHTML = ("<font size=4>Travel-time: "+Math.floor(parseFloat(tt))+" minutes</font>"); //Travel-time instead of Clearpath
			document.getElementById('tt').style.visibility="visible";
			//document.getElementById('btn').style.visibility = "hidden";	
			document.getElementById('newSearch').style.visibility = "visible";
			document.getElementById('btn2').style.visibility = "visible";	
		}
		getturnInfo();
	}
	
	
	function drawPoints(){
		////alert("Draw Points Called");	
		var path = poly.getPath();
		if(lati.length>2){
			for(var i=0;i<lati.length-1;i++){
				//document.getElementById('test').innerHTML = "<font size=2>"+ lati.length + "</font>";
				path.push(new google.maps.LatLng(lati[i],longi[i]));
			}
		}
		markers[0].setPosition(new google.maps.LatLng(lati[0],longi[0]));
		markers[1].setPosition(new google.maps.LatLng(lati[lati.length-1],longi[lati.length-1]));
		calcRoute();
	}
	
	
	function HomeControl(controlDiv, map) {
	  controlDiv.style.padding = '5px';

	  // Set CSS for the control border.
	  var controlUI = document.createElement('DIV');
	  controlUI.style.backgroundColor = 'white';
	  controlUI.style.borderStyle = 'solid';
	  controlUI.style.borderWidth = '2px';
	  controlUI.style.cursor = 'pointer';
	  controlUI.style.textAlign = 'center';
	  controlUI.title = 'Click to reset the map';
	  controlDiv.appendChild(controlUI);

	  // Set CSS for the control interior.
	  var controlText = document.createElement('DIV');
	  controlText.style.fontFamily = 'Arial,sans-serif';
	  controlText.style.fontSize = '12px';
	  controlText.style.paddingLeft = '4px';
	  controlText.style.paddingRight = '4px';
	  controlText.innerHTML = 'Reset';
	  controlUI.appendChild(controlText);
	  google.maps.event.addDomListener(controlUI, 'click', function() {
		map.setCenter(los_angeles);
		map.setZoom(10);
		directionsDisplay.setMap(null);
		// Create a renderer for directions and bind it to the map.
		
		directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);
		directionsDisplay.setMap(map);
		poly.getPath().clear();
		poly = new google.maps.Polyline(polyOptions);
		poly.setMap(map);
		clearOverlays();
		//document.getElementById('slider').disabled=true;
		checkDepartNowRadio();				
		checkArriveByRadio();
		markers = new Array();
		lati= new Array();
		longi= new Array();
		count=0;
		document.getElementById('tt').style.visibility="hidden";
		document.getElementById('tt2').style.visibility="hidden";
		document.getElementById('newSearch').style.visibility = "hidden";
		document.getElementById('btn2').style.visibility = "hidden";
	  });
	}
	
	function clearOverlays() {
      for (var i=0;i<count;i++) {
		markers[i].setMap(null);
	  }
	}
      
    function calcRoute() {
    	  var start = markers[0].getPosition();
    	  var end = markers[1].getPosition();
    	  var request = {
    	    origin:start,
    	    destination:end,
    	    travelMode: google.maps.TravelMode.DRIVING
    	  };

		  var arriveBy = document.getElementById('arrive_by').checked; 
		  if(arriveBy!=true){
			//swapnil.c jan 23 : do nothing : don't display google path too
			  directionsService.route(request, function(result, status) {
				if (status == google.maps.DirectionsStatus.OK) {
				  directionsDisplay.setDirections(result);
				  var time = result.routes[0].legs[0].duration.value/60;
				  //document.getElementById('tt2').innerHTML = "<font size=4>Google: "+ Math.floor(time) + " minutes</font>";
				  //document.getElementById('tt2').style.visibility="visible";    			
				}
			  });
		  }
		  else{
				var time = document.getElementById('time_select').value;
				var hrs = parseInt(time.substring(0,2),10);
				var mins = parseInt(time.substring(3,5),10);
				
				var totalTime = hrs*60+mins;
				var hrsCP = Math.floor((totalTime-clearpathTime)/60);
				var minsCP = (totalTime-clearpathTime)%60;
				
				var index = ((hrs-6)*4)+(mins/15);
		  		document.getElementById('tt2').innerHTML = "<font size=4>Depart At: "+hrsCP+":"+minsCP +"</font>";
				document.getElementById('tt2').style.visibility="visible"; 
		  }
    }
      
	function addLatLng(event) {	
		var fromLocation = document.getElementById('from').value;
		var toLocation = document.getElementById('to').value;		
		
		//alert(fromLocation);
		if(!(fromLocation!='Enter a location' && toLocation!='Enter a location' && fromLocation!='' && toLocation!='')){	
			if(count<2)
			{
				markers[count++] = new google.maps.Marker({
				position: event.latLng,
				map: map
				});
				if(count==1){
					document.getElementById('from').style.visibility="hidden";
					document.getElementById('fromLatLng').innerHTML = event.latLng;
					document.getElementById('fromLatLng').style.visibility = "visible";
				}
					
			}
			if(count==2)
			{
				document.getElementById('to').value=event.latLng;
				///document.getElementById('slider').disabled=false;
				checkDepartNowRadio();				
				checkArriveByRadio();
						 
				document.getElementById('to').style.visibility = "hidden";
				document.getElementById('toLatLng').innerHTML = event.latLng;
				document.getElementById('toLatLng').style.visibility = "visible";			
			}
		}
	}
	
	function dataChangedOnSlide(){
		clickedGetButton=0;	  
		clearOverlays();
		if(markers != null){
			markers[0].setMap(null);
			markers[1].setMap(null);
		}
		if(poly != null){
			poly.getPath().clear();
		}
		document.getElementById('btn').style.visibility = "visible";
		document.getElementById('fromLatLng').innerHTML='';
		document.getElementById('toLatLng').innerHTML='';
		document.getElementById('content').innerHTML='';
		document.getElementById('tt').innerHTML='';
		document.getElementById('tt2').innerHTML='';
		document.getElementById('totalDistance').innerHTML='';
		document.getElementById('accidents').innerHTML='';		
	}
	 
	 function dataChanged(){	
		//alert(event.keyCode);	
		clickedGetButton=0;	  
		markers[0].setMap(null);
		markers[1].setMap(null);
		poly.getPath().clear();
		clearOverlays();
		document.getElementById('btn').style.visibility = "visible";
		document.getElementById('fromLatLng').innerHTML='';
		document.getElementById('toLatLng').innerHTML='';
		document.getElementById('content').innerHTML='';
		document.getElementById('tt').innerHTML='';
		document.getElementById('tt2').innerHTML='';
		document.getElementById('totalDistance').innerHTML='';
		document.getElementById('accidents').innerHTML='';
		if(event.keyCode==13){
			//alert(event.keyCode);
			reset();
			getLatLongFromAddress(getPath);
		}	
	  }
	
	  function getTodaysDay(){
		var d = new Date();
		var n = d.getDay();
		var element = document.getElementById('day');
		switch(n){
			case 1: element.value = 'Monday'; break;
			case 2: element.value = 'Tuesday'; break;
			case 3: element.value = 'Wednesday'; break;
			case 4: element.value = 'Thursday'; break;
			case 5: element.value = 'Friday'; break;
			case 6: element.value = 'Saturday'; break;
			case 7: element.value = 'Sunday'; break;
			default: element.value = 'Monday'; break;
		}
	  }	
	
	  function checkDepartNowRadio(){
		var departNow = document.getElementById('depart_now').checked; 
		if(departNow==true)
		{
			//alert('radio button checked');
			//document.getElementById('slider').style.visibility="hidden";
			//document.getElementById('time_select').style.visibility = "hidden";
			/*var d = new Date();
			var hrs = d.getHours();
			var mins = d.getMinutes();
			//var index = ((hrs-6)*4)+(mins/15);
			if(hrs>=6 && hrs<=20){
				if(mins >= 0 && mins<15) 
					mins = '15';
				else if(mins>=15 && mins<30)
					mins = '30';
				else if(mins>=30 && mins<45)
					mins = '45';			
				else if(mins>=45 && mins<60){
					mins = '00';			
					hrs = hrs+1;
				}					
				if(hrs<10) 
					hrs = '0' + hrs;
				document.getElementById('time_select').value=hrs+":"+mins;
			}
			else*/{
				//document.getElementById('time_select').value="06:00";
			}
		}
		else
		{
		  checkArriveByRadio();
		}	  
	  }

	  function checkArriveByRadio(){
		var arriveBy = document.getElementById('arrive_by').checked; 
		if(arriveBy==true)
		{
			//alert('radio button checked');
			//document.getElementById('time_select').value="06:00";
			///document.getElementById('slider').style.visibility="visible";
			
			//document.getElementById('time_select').style.visibility = "visible";
			document.getElementById('time_selectAMPM').style.visibility = "visible";
		}
		else{
				checkDepartNowRadio();
		}
	  }	
	  
	  function reset(){
		dataChanged();  
		initialize();
		clickedGetButton=0;
	  }
	
      function initialize() {
		 document.getElementById('turninfo').style.display = "none";
		 document.getElementById('loading').style.visibility="hidden";
		 document.getElementById('loadingImage').style.visibility="hidden";
		 document.getElementById('tt').style.visibility="hidden";
		 document.getElementById('tt2').style.visibility="hidden";
		 document.getElementById('btn').style.visibility = "visible";
		 document.getElementById('btn2').style.visibility = "hidden";
		 document.getElementById('newSearch').style.visibility = "hidden";
		 //document.getElementById('slider').disabled=false;
		 //document.getElementById('time_select').style.display = "none";
		 document.getElementById('fromLatLng').style.visibility = "hidden";
		 document.getElementById('toLatLng').style.visibility = "hidden";
		 document.getElementById('from').style.visibility = "visible";
		 document.getElementById('to').style.visibility = "visible";
		 document.getElementById('from').value = "";
		 document.getElementById('to').value = "";	
		 document.getElementById('totalDistance').innerHTML = "";
		 document.getElementById('accidents').innerHTML = "";
		 document.getElementById('fromLatLng').innerHTML = "";
		 document.getElementById('toLatLng').innerHTML = "";
		 
		 document.getElementById('map_canvas').style.width=(window.innerWidth-387)+"px";
		 document.getElementById('map_canvas').style.height=(window.innerHeight-65)+"px";
		 document.getElementById('turninfo').style.height=(window.innerHeight-410)+"px"; 
		 document.getElementById('turninfo').style.maxHeight=(window.innerHeight-410)+"px";

		 //document.getElementById('sidebar').style.max-width=(window.innerHeight-520)+"px";
		 count = 0;
		 clickedGetButton=0;			
	     directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);
		 checkDepartNowRadio();
		 getTodaysDay();
		 
		 
		  // Try W3C Geolocation (Preferred)
		  if(navigator.geolocation) {
			browserSupportFlag = true;
			navigator.geolocation.getCurrentPosition(function(position) {
			  //initialLocation = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);
			  var fromLL = document.getElementById('fromLatLng'); // fromLatLng is my hidden field, use your own
			  fromLL.innerHTML = position.coords.latitude + ',' + position.coords.longitude;
			  fromLocationLL = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);			
			  //document.getElementById('from').value = 'My Location'; //swapnil.c : undergoing implementation
			}, function() {
			  handleNoGeolocation(browserSupportFlag);
			});
		  }		
		  // Browser doesn't support Geolocation
		  else {
			browserSupportFlag = false;
			handleNoGeolocation(browserSupportFlag);
		  }	
		 
        var mapOptions = {
		  center: new google.maps.LatLng(34.03033656769632, -118.23760986328125),
          zoom: 11,
		  height: window.innerHeight,
          mapTypeId: google.maps.MapTypeId.ROADMAP		  
        };
        map = new google.maps.Map(document.getElementById('map_canvas'),
          mapOptions);
		rendererOptions = {
			map: map
		};	
		directionsDisplay.setMap(map);
		google.maps.event.addListener(map, 'click', addLatLng);
		//google.maps.event.addListener(map, 'click', function (event) { 
        ////alert('Hello World!'); });		  

        var inputFrom = document.getElementById('from');
		var inputTo = document.getElementById('to');
        var autocompleteFrom = new google.maps.places.Autocomplete(inputFrom);
		var autocompleteTo = new google.maps.places.Autocomplete(inputTo);

        autocomplete.bindTo('bounds', map);

        var infowindow = new google.maps.InfoWindow();
        var marker = new google.maps.Marker({
          map: map
        });

		var homeControlDiv = document.createElement('DIV');
		var homeControl = new HomeControl(homeControlDiv, map);
		homeControlDiv.index = 1;
		map.controls[google.maps.ControlPosition.TOP_RIGHT].push(homeControlDiv);
		poly = new google.maps.Polyline(polyOptions);
		poly.setMap(map);
		
        google.maps.event.addListener(autocompleteFrom, 'place_changed', function() {
          infowindow.close();
          marker.setVisible(false);
          input.className = '';
          var place = autocomplete.getPlace();
          if (!place.geometry) {
            // Inform the user that the place was not found and return.
            input.className = 'notfound';
            return;
          }

          // If the place has a geometry, then present it on a map.
          if (place.geometry.viewport) {
            map.fitBounds(place.geometry.viewport);
          } else {
            map.setCenter(place.geometry.location);
            map.setZoom(17);  // Why 17? Because it looks good.
          }
          var image = new google.maps.MarkerImage(
              place.icon,
              new google.maps.Size(71, 71),
              new google.maps.Point(0, 0),
              new google.maps.Point(17, 34),
              new google.maps.Size(35, 35));
          marker.setIcon(image);
          marker.setPosition(place.geometry.location);

          var address = '';
          if (place.address_components) {
            address = [
              (place.address_components[0] && place.address_components[0].short_name || ''),
              (place.address_components[1] && place.address_components[1].short_name || ''),
              (place.address_components[2] && place.address_components[2].short_name || '')
            ].join(' ');
          }

          infowindow.setContent('<div><strong>' + place.name + '</strong><br>' + address);
          infowindow.open(map, marker);
        });
		
		google.maps.event.addListener(autocompleteTo, 'place_changed', function() {
          infowindow.close();
          marker.setVisible(false);
          input.className = '';
          var place = autocomplete.getPlace();
          if (!place.geometry) {
            // Inform the user that the place was not found and return.
            input.className = 'notfound';
            return;
          }

          // If the place has a geometry, then present it on a map.
          if (place.geometry.viewport) {
            map.fitBounds(place.geometry.viewport);
          } else {
            map.setCenter(place.geometry.location);
            map.setZoom(17);  // Why 17? Because it looks good.
          }
          var image = new google.maps.MarkerImage(
              place.icon,
              new google.maps.Size(71, 71),
              new google.maps.Point(0, 0),
              new google.maps.Point(17, 34),
              new google.maps.Size(35, 35));
          marker.setIcon(image);
          marker.setPosition(place.geometry.location);

          var address = '';
          if (place.address_components) {
            address = [
              (place.address_components[0] && place.address_components[0].short_name || ''),
              (place.address_components[1] && place.address_components[1].short_name || ''),
              (place.address_components[2] && place.address_components[2].short_name || '')
            ].join(' ');
          }

          infowindow.setContent('<div><strong>' + place.name + '</strong><br>' + address);
          infowindow.open(map, marker);
        });
		google.maps.event.addDomListener(window, 'load', initialize);
      }
    </script>
  </head>
  <body onLoad="initialize()" style="background:url(images2/logo_background.png); background-repeat:repeat-x;">
      <!-- <input id="searchTextField" type="text" size="50"> -->
	<!--<div style=" width:window.innerWidth; height:80px;"></div>-->
	<div id="upperbar"><a href="test2.html"><img src="images2/logo_clearpath.png" style="position:absolute; top:10px; left:15px; border-style:none;"></a></div>	
	<!--<table>
	  <tr>
        <td align="top">	  
		<div id="sidebar" style="margin-left:10px; top:90px; height:auto; width:425px; max-width:425px; overflow:auto; overflow-y:hidden; overflow-x:hidden;">-->
		<div id="sidebar" style="margin-left:10px; top:90px; scale:80%">
		<table width="300px">
			<tr>
			  <td><img src="images2/addrA.png" style="position:absolute; top:90px;"></td>  
				<td><!--<div><img src="images2/from_input.png" style="position:absolute; top:86px; left:45px;"></div>-->
				<input type="text" id="from" value="" size="35" onKeyPress="dataChanged()" style="position:absolute; top:88px; left:47px; width:317px; height:24px;"/></td>
			</tr>
			<tr>
			  <td><img src="images2/addrB.png" style="position:absolute; top:130px;"></td>   
				<td><!--<div><img src="images2/from_input.png" style="position:absolute; top:126px; left:45px;"></div>--> <!-- similar to to_input -->
				<input type="text" id="to" value="" size="35" onKeyPress="dataChanged()" style="position:absolute; top:128px; left:47px; width:317px; height:24px;" /></td>
			</tr>
		</table>		
		<table width="300px">
				<tr>
					<td><img src="images2/time_select.png" style="position:absolute; top:171px; left:10px;"></td>
					<td><input type="radio" name="time_radio" id="depart_now" value="depart_now" onclick="onRadioListener()" style="position:absolute; border-style:none; top:180px; left:55px;" checked>
					<!--<img src="images2/depart_at.png" style="position:absolute; top:180px; left:68px;">-->
					<label style="position:absolute; top:178px; left:78px;">Depart At</label></td>
					<td><input type="radio" name="time_radio" id="arrive_by" value="arrive_by" onclick="onRadioListener()" style="position:absolute; border-style:none; top:180px; left:168px;">
					<!--<img src="images2/arrive_by.png" style="position:absolute; top:180px; left:190px;">-->
					<label style="position:absolute; top:178px; left:190px;">Arrive By</label></td>
					<td width="10px"><!--<div><img src="images2/time_select_input.png" style="position:absolute; top:175px; left:288px;"></div>-->
					<input type="text" id="time_select" size="5px" style="visibility:hidden; border:0; font-weight:bold; position:absolute; top:177px; left:290px; width:71px; height:26px; padding-left:10px; padding-right:0px;">
					<input type="text" id="time_selectAMPM" size="5px" style="border:0; font-weight:bold; position:absolute; top:177px; left:280px; width:81px; height:26px; padding-left:0px; padding-right:0px;"></td>
				</tr>
		</table>
		<div id="slider" class="sl" style="position:absolute; top:220px; left:20px;"></div>
		<!--<table width="300px">-->
			<!--<tr>-->
				<!--<td>--><!--<img src="images2/day_of_departure.png" style="position:absolute; top:255px; left:15px;">-->
				<!--<img src="images2/day_input.png" style="position:absolute; top:250px; left:190px;">-->
				<label style="position:absolute; top:253px; left:25px;">Day of Departure</label><!--</td>-->
				<!--<td>--><select id="day" onchange="dataChanged()" style="position:absolute; top:252px; left:192px; width:172px; height:28px;">
					<option>Monday</option>
					<option>Tuesday</option>
					<option>Wednesday</option>
					<option>Thursday</option>
					<option>Friday</option>
					<option>Saturday</option>
					<option>Sunday</option>
				</select><!--</td>
			</tr>
		</table>-->

		<img src="images2/travel_mode.png" style="position:absolute; top:300px; left:13px;">
		<div id="toggle-button"
			 data-toggleButton-transitionspeed="500%"
			 data-toggleButton-style-custom-enabled-background="#4C8799"
			 data-toggleButton-style-custom-enabled-gradient="#4C8799" style="position:absolute; top:300px; left:57px;">
			<input id="checkBoxToggleButton" type="checkbox">
		</div>					
			<!--<td>Travel Mode: <select id="mode">
				<option value="DRIVING">Driving</option>
				<option value="WALKING">Walking </option>
				<option value="BICYCLING">Bicycling  </option>
			</select>-->

		<!--<table width="300px">		
			<tr>
				<td>--><a href="javascript:onButtonClick()" id="btn" class="getpath" style="position:absolute; top:350px; left:15px;" >Get Directions</a><!--</td>
				<input type="button" id="btn" value="Get Path" onClick="getLatLongFromAddress()"/> -->
			<!--</tr>
			<tr>
				<td><a href="javascript:reset()" id="newSearch" class="getpath">New Search</a>
				<td>--><a href="javascript:reset()" id="newSearch"></a>
				<a href="javascript:getturnInfo()" id="btn2" style="position:absolute; top:390px; left:20px;">TurnByTurn</a><!--</td>
			</tr>
			<input type="button" id="btn2" value="Directions" onClick="getturnInfo()"/></td></tr>
		</table>-->
		
		<div id="tt" style="position:absolute; top:25px; left:450px; color:rgb(214,251,255);"></div>	
		<div id="totalDistance" style="position:absolute; top:25px; left:680px; color:rgb(214,251,255);"></div>
		<div id="accidents" style="position:absolute; top:25px; left:890px; color:rgb(214,251,255);"></div>
		<div id="tt2" style="position:absolute; top:25px; left:1050px; color:rgb(214,251,255);"></div>
		<!--<div id="totalDistance" style="position:absolute; top:25px; left:890px; color:rgb(214,251,255);"></div>
		<div id="accidents" style="position:absolute; top:25px; left:1080px; color:rgb(214,251,255);"></div>-->
		<div id="fromLatLng" style="position:absolute; top:95px; left:45px; font-size:12px; color:white;">fromLL</div>
		<div id="toLatLng" style="position:absolute; top:130px; left:45px; font-size:12px; color:white;">toLL</div>
		
		<!--<table width="300px" >			
			<tr><td>--><div id="turninfo" style="position:absolute; top:410px; left:10px; overflow:auto; overflow-y:scroll; overflow-x:hidden;">
			<!--<p id="test"></p>-->
			<p id ="content"><!--Loading...--></p></div><!--</td></tr>    
			<tr><td>--><p id="loading" align="left" style="position:absolute; top:390px; left:20px;"><img id="loadingImage" src="images2/loading.gif" style="width:70%; height:70%;"></p><!--</td></tr>
		</table>-->
      </div><!--</td>
      <td>-->
		<div id="map_canvas" style="position:absolute; left:380px; top:51px; border-style:groove;"></div>
	  <!--</td>	
	</tr>
	</table>-->
	
	<!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>-->
	<script src="../static/js/jquery.toggle.buttons.js"></script>
	<script>
		$('#toggle-button').toggleButtons({
			width: 305,
			height:30,
			font:{
				'font-size': '18px',
				'font-style': 'regular'
			},
			label:{
				enabled: "Carpool",
				disabled: "No Carpool"			
			}
		});
	</script>
	
  </body>
</html>
